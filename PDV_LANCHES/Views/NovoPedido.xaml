<Window x:Class="PDV_LANCHES.Views.NovoPedido"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        WindowState="Maximized" WindowStyle="SingleBorderWindow"
        Title="Novo Pedido" Height="650" Width="1000"
        WindowStartupLocation="CenterScreen" Background="#0f172a">
    <Window.Resources>
        <Style x:Key="DarkComboBox" TargetType="ComboBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Background" Value="#1E293B"/>
            <Setter Property="BorderBrush" Value="#334155"/>
            <Setter Property="Height" Value="45"/>
            <Setter Property="Padding" Value="12,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton Name="ToggleButton" Background="#1E293B" BorderBrush="#334155" BorderThickness="1" 
                                          IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" Grid.ColumnSpan="2">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border CornerRadius="8" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="1">
                                            <Path HorizontalAlignment="Right" Margin="0,0,10,0" VerticalAlignment="Center" Fill="#94A3B8" Data="M 0 0 L 4 4 L 8 0 Z"/>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter Name="ContentSite" IsHitTestVisible="False" Content="{TemplateBinding SelectionBoxItem}" Margin="12,0,30,0" VerticalAlignment="Center" HorizontalAlignment="Left"/>
                            <Popup Name="PART_Popup" Placement="Bottom" IsOpen="{TemplateBinding IsDropDownOpen}" AllowsTransparency="True">
                                <Border Background="#0F172A" BorderBrush="#334155" BorderThickness="1" CornerRadius="8" MinWidth="{Binding ActualWidth, RelativeSource={RelativeSource TemplatedParent}}">
                                    <ItemsPresenter />
                                </Border>
                            </Popup>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="110"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="10,0,10,25">
            <Button x:Name="btnVoltar" Content="" FontFamily="Segoe MDL2 Assets" FontSize="18" Width="45" Height="45" Background="#1e293b" Foreground="White" BorderThickness="1" BorderBrush="#334155" Cursor="Hand" Click="btnVoltar_Click">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="22"/>
                    </Style>
                </Button.Resources>
            </Button>
            <TextBlock Text="Finalizar Novo Pedido" FontSize="28" FontWeight="ExtraBold" Foreground="White" VerticalAlignment="Center" Margin="15,0,0,0"/>
        </StackPanel>

        <Border Grid.Row="1" Background="#1e293b" CornerRadius="12" Padding="20" Margin="10,0,10,20" BorderBrush="#334155" BorderThickness="1">
            <StackPanel Orientation="Horizontal">
                <StackPanel Margin="0,0,20,0">
                    <TextBlock Text="CPF DO CLIENTE" FontSize="10" FontWeight="Bold" Foreground="#94a3b8" Margin="0,0,0,8"/>
                    <TextBox x:Name="inputCpfCliente" Width="200" Height="45" Padding="12,0" FontSize="15" MaxLength="14" TextChanged="inputCpfCliente_TextChanged" VerticalContentAlignment="Center" Background="#0f172a" Foreground="White" BorderBrush="#475569" CaretBrush="White"/>
                </StackPanel>
                <StackPanel Margin="0,0,20,0">
                    <TextBlock Text="NOME DO CLIENTE" FontSize="10" FontWeight="Bold" Foreground="#94a3b8" Margin="0,0,0,8"/>
                    <TextBox x:Name="inputNomeCliente" Width="350" Height="45" Padding="12,0" FontSize="15" VerticalContentAlignment="Center" Background="#0f172a" Foreground="White" BorderBrush="#475569" CaretBrush="White" />
                </StackPanel>
                <TextBlock x:Name="LabelCPF" VerticalAlignment="Bottom" Margin="0,0,0,10" FontSize="18" FontWeight="Bold" Foreground="#60a5fa"/>
            </StackPanel>
        </Border>

        <Grid Grid.Row="2" Margin="10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="320"/>
            </Grid.ColumnDefinitions>

            <ScrollViewer x:Name="scrollCardapio" Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="ListaCardapioItems">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Width="220" Margin="0,0,10,10" Background="#1e293b" CornerRadius="12" Padding="12" BorderBrush="#334155" BorderThickness="1">
                                <StackPanel>
                                    <Border CornerRadius="10" ClipToBounds="True" Margin="0,0,0,10">
                                        <Image Source="{Binding pathImg}" Width="180" Height="100" Stretch="UniformToFill"/>
                                    </Border>
                                    <TextBlock Text="{Binding Nome}" FontSize="14" FontWeight="Bold" Foreground="White"/>
                                    <TextBlock Text="{Binding Valor, StringFormat='R$ {0:F2}'}" FontSize="16" Foreground="#60a5fa" FontWeight="Bold"/>
                                    <Grid Margin="0,10,0,0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="50"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBox Text="{Binding QuantidadeSelecionada}" Height="35" Background="#0f172a" Foreground="White" HorizontalContentAlignment="Center" VerticalContentAlignment="Center"/>
                                        <Button Grid.Column="1" Content="+" Margin="5,0,0,0" Background="#3b82f6" Foreground="White" Click="AdicionarItem_Click" Tag="{Binding}"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <Border x:Name="panelCarrinho" Grid.Column="1" Margin="10,0,0,0" Background="#1e293b" CornerRadius="12" Padding="15" BorderBrush="#334155" BorderThickness="1">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="ITENS DO PEDIDO" FontSize="12" FontWeight="Bold" Foreground="#94a3b8" Margin="0,0,0,15"/>
                    <ListBox x:Name="listCarrinho" Background="Transparent" BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="#334155" BorderThickness="0,0,0,1" Padding="0,8">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel>
                                            <TextBlock Text="{Binding NomeProduto}" Foreground="White" FontWeight="SemiBold" TextWrapping="Wrap"/>
                                            <TextBlock Text="{Binding Quantidade, StringFormat='{}{0}x unidades'}" FontSize="11" Foreground="#94a3b8"/>
                                        </StackPanel>
                                        <Button Grid.Column="1" Margin="20,0,0,0" Content="" FontFamily="Segoe MDL2 Assets" Foreground="#ef4444" Background="Transparent" BorderThickness="0" FontSize="16" Click="RemoverItem_Click" Tag="{Binding}"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <Border x:Name="borderResumo" Grid.ColumnSpan="2" Visibility="Collapsed" Background="#1e293b" CornerRadius="15" Padding="40" BorderBrush="#22c55e" BorderThickness="2">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel MaxWidth="600" HorizontalAlignment="Center">
                        <StackPanel x:Name="stackResumoItens"/>
                        <Border BorderBrush="#334155" BorderThickness="0,1,0,0" Margin="0,30,0,20"/>
                        <TextBlock Text="FORMA DE PAGAMENTO" FontSize="12" FontWeight="Bold" Foreground="#94a3b8" Margin="0,0,0,10"/>
                        <ComboBox x:Name="comboPagamento" Style="{StaticResource DarkComboBox}" DisplayMemberPath="Descricao" SelectedValuePath="Id"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <Border Grid.Row="3" Background="#1e293b" CornerRadius="15" Margin="10,15,10,10" Padding="30,0" BorderBrush="#334155" BorderThickness="1">
            <Grid>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Total do Pedido:" FontSize="16" Foreground="#94a3b8" VerticalAlignment="Center"/>
                    <TextBlock x:Name="txtTotalDisplay" Text="R$ 0,00" FontSize="32" FontWeight="Bold" Foreground="#22c55e" Margin="15,0,0,0"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button x:Name="buttonSairSemDarBaixa" Content="Dar baixa depois" Visibility="Hidden" Width="200" Height="50" Background="#64748b" Foreground="White" FontWeight="Bold" Margin="0,0,15,0" Click="ButtonSairSemDarBaixa_Click">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="10"/>
                            </Style>
                        </Button.Resources>
                    </Button>
                    <Button x:Name="buttonProximo" Content="PRÓXIMO ➔" Width="220" Height="55" Background="#22c55e" Foreground="White" FontSize="16" FontWeight="ExtraBold" Click="Button_Click">
                        <Button.Resources>
                            <Style TargetType="Border">
                                <Setter Property="CornerRadius" Value="12"/>
                            </Style>
                        </Button.Resources>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>